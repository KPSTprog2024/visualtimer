<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>みえるタイマー</title>
  <style>
    /* 全体レイアウト */
    body {
      margin: 0;
      padding: 0;
      font-family: sans-serif;
      background: #fffbea; /* やさしい色味 */
    }
    header {
      text-align: center;
      padding: 1rem;
      background: #ffc107; /* ポップなカラー */
      color: #4a4a4a;
    }
    h1 {
      margin: 0;
      font-size: 2rem;
    }

    /* コンテナ */
    .container {
      width: 90%;
      max-width: 600px;
      margin: 0 auto;
      padding: 1rem;
      text-align: center;
    }

    /* トップページ：タイマーモード選択ボタン */
    .mode-selection {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 1rem;
    }
    .mode-button {
      flex: 1 1 40%;
      max-width: 200px;
      padding: 1rem;
      font-size: 1.2rem;
      background: #fff3cd;
      border: 2px solid #ffecb5;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.3s;
    }
    .mode-button:hover {
      background: #ffe082;
    }

    /* タイマー画面全体（非表示にして、選択時に表示） */
    .timer-screen {
      display: none;
    }

    /* タイマー設定部分 */
    .timer-settings {
      margin-top: 1rem;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 0.5rem;
    }
    .preset-button, .custom-time-button {
      background: #c8e6c9;
      border: 2px solid #a5d6a7;
      border-radius: 8px;
      padding: 0.7rem 1rem;
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.3s;
    }
    .preset-button:hover, .custom-time-button:hover {
      background: #a5d6a7;
    }

    /* 自由入力 */
    .custom-input {
      width: 60px;
      text-align: center;
      font-size: 1rem;
      padding: 0.4rem;
    }

    /* スタート／ストップ／リセットボタン */
    .control-buttons {
      margin-top: 1rem;
      display: flex;
      justify-content: center;
      gap: 1rem;
    }
    .control-button {
      background: #bbdefb;
      border: 2px solid #90caf9;
      border-radius: 8px;
      padding: 0.8rem 1.2rem;
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.3s;
    }
    .control-button:hover {
      background: #90caf9;
    }

    /* タイマー表示エリア */
    .display-area {
      margin-top: 2rem;
      height: 300px;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .hidden {
      display: none;
    }

    /* ★ 各パターンのスタイル ★ */

    /* 1. 円（針が通った部分を塗りつぶす） */
    .circle-timer-container {
      position: relative;
      width: 220px;
      height: 220px;
    }
    /* SVG全体を親要素に合わせる */
    .circle-timer-container svg {
      width: 100%;
      height: 100%;
    }
    /* 背景円 */
    .circle-bg {
      fill: #ffffff;
      stroke: #aaaaaa;
      stroke-width: 2;
    }
    /* 塗りつぶしアーク */
    .circle-fill {
      fill: #4CAF50; /* 同じ色を使用 */
    }

    /* 2. バー */
    .bar-timer-container {
      width: 80%;
      max-width: 300px;
      height: 30px;
      border: 2px solid #555;
      position: relative;
      margin: 0 auto;
      background: #ffffff;
    }
    .bar-fill {
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      background: #4CAF50;
      width: 0%;
      transition: width 0.2s linear;
    }

    /* 3. 砂時計 */
    .sand-container {
      width: 120px;
      height: 200px;
      position: relative;
    }
    /* 砂時計の枠（簡易版） */
    .sand-glass-frame {
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 120px;
      height: 200px;
      background: none;
      border-left: 4px solid #555;
      border-right: 4px solid #555;
    }
    /* 上下の三角形 (簡易) */
    .triangle-top, .triangle-bottom {
      width: 0;
      height: 0;
      border-left: 58px solid transparent;
      border-right: 58px solid transparent;
      position: absolute;
      left: 2px; /* 枠線内側 */
    }
    .triangle-top {
      border-bottom: 60px solid #555;
      top: 0;
    }
    .triangle-bottom {
      border-top: 60px solid #555;
      bottom: 0;
    }
    /* 砂部分(上と下) */
    .sand-top, .sand-bottom {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      width: 110px;
      background: #4CAF50;
    }
    .sand-top {
      top: 5px;
      height: 0px; /* 初期は0 */
      border-radius: 0 0 50% 50%;
      transition: height 0.5s linear;
    }
    .sand-bottom {
      bottom: 5px;
      height: 0px; /* 初期は0 */
      border-radius: 50% 50% 0 0;
      transition: height 0.5s linear;
    }

    /* 4. 個数 */
    .count-container {
      display: flex;
      flex-wrap: wrap;
      gap: 0.3rem;
      justify-content: center;
      max-width: 300px;
    }
    .count-item {
      width: 20px;
      height: 20px;
      background: #4CAF50;
      border-radius: 50%;
    }
  </style>
</head>
<body>
<header>
  <h1>みえるタイマー</h1>
</header>

<div class="container">

  <!--◆◆◆ モード選択画面 ◆◆◆-->
  <div id="modeSelection" class="mode-selection">
    <button class="mode-button" data-mode="circle">●　サークル</button>
    <button class="mode-button" data-mode="bar">━　バー</button>
    <button class="mode-button" data-mode="sand">⌛　砂時計</button>
    <button class="mode-button" data-mode="count">●●　個数</button>
  </div>

  <!--◆◆◆ タイマー画面 ◆◆◆-->
  <div id="timerScreen" class="timer-screen">
    <!-- 時間設定ボタン -->
    <div class="timer-settings">
      <button class="preset-button" data-minutes="1">1分</button>
      <button class="preset-button" data-minutes="3">3分</button>
      <button class="preset-button" data-minutes="5">5分</button>
      <input id="customInput" class="custom-input" type="number" min="1" max="999" placeholder="分">
      <button id="customTimeBtn" class="custom-time-button">セット</button>
    </div>

    <!-- 操作ボタン -->
    <div class="control-buttons">
      <button id="startBtn" class="control-button">スタート</button>
      <button id="stopBtn" class="control-button">ストップ</button>
      <button id="resetBtn" class="control-button">リセット</button>
    </div>

    <!-- タイマー表示エリア -->
    <div id="displayArea" class="display-area">
      <!-- 選択されたモードに応じて中身を切り替える -->
      
      <!-- (1) Circle Timer -->
      <div id="circleTimer" class="circle-timer-container hidden">
        <svg viewBox="0 0 100 100">
          <!-- 背景用の円 -->
          <circle class="circle-bg" cx="50" cy="50" r="45"/>
          <!-- 塗りつぶし用のパス -->
          <path id="circleFillPath" class="circle-fill" d="" />
        </svg>
      </div>

      <!-- (2) Bar Timer -->
      <div id="barTimer" class="bar-timer-container hidden">
        <div id="barFill" class="bar-fill"></div>
      </div>

      <!-- (3) Sand Timer -->
      <div id="sandTimer" class="sand-container hidden">
        <!-- 枠と三角形 -->
        <div class="sand-glass-frame"></div>
        <div class="triangle-top"></div>
        <div class="triangle-bottom"></div>
        <!-- 砂 上下 -->
        <div id="sandTop" class="sand-top"></div>
        <div id="sandBottom" class="sand-bottom"></div>
      </div>

      <!-- (4) Count Timer -->
      <div id="countTimer" class="count-container hidden">
        <!-- JSで要素を動的に追加/削除 -->
      </div>

    </div>
  </div>
</div>

<script>
/* ===========================
   タイマー全体の制御ロジック
   =========================== */
(function(){
  // DOM取得
  const modeSelection = document.getElementById('modeSelection');
  const timerScreen   = document.getElementById('timerScreen');
  const startBtn      = document.getElementById('startBtn');
  const stopBtn       = document.getElementById('stopBtn');
  const resetBtn      = document.getElementById('resetBtn');
  const displayArea   = document.getElementById('displayArea');
  const customInput   = document.getElementById('customInput');
  const customTimeBtn = document.getElementById('customTimeBtn');

  // タイマー表示要素
  const circleTimer = document.getElementById('circleTimer');
  const circleFillPath = document.getElementById('circleFillPath');
  const barTimer   = document.getElementById('barTimer');
  const barFill    = document.getElementById('barFill');
  const sandTimer  = document.getElementById('sandTimer');
  const sandTop    = document.getElementById('sandTop');
  const sandBottom = document.getElementById('sandBottom');
  const countTimer = document.getElementById('countTimer');

  // 選択されたモード
  let currentMode = null;

  // タイマー管理用
  let totalTime = 0;    // 設定した合計秒数
  let remainingTime = 0;
  let timerInterval = null;

  /* -------------------------
     モード選択時の処理
     ------------------------- */
  const modeButtons = document.querySelectorAll('.mode-button');
  modeButtons.forEach(button => {
    button.addEventListener('click', () => {
      // 選択されたモードを取得
      currentMode = button.getAttribute('data-mode');
      // モード選択画面を隠して、タイマー画面を表示
      modeSelection.style.display = 'none';
      timerScreen.style.display = 'block';

      // 各表示をリセット
      hideAllTimerDisplays();
      if(currentMode === 'circle'){
        circleTimer.classList.remove('hidden');
      } else if(currentMode === 'bar'){
        barTimer.classList.remove('hidden');
      } else if(currentMode === 'sand'){
        sandTimer.classList.remove('hidden');
      } else if(currentMode === 'count'){
        countTimer.classList.remove('hidden');
      }
      resetAllDisplays();
    });
  });

  /* -------------------------
     プリセットボタンの処理
     ------------------------- */
  const presetButtons = document.querySelectorAll('.preset-button');
  presetButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      const minutes = parseInt(btn.getAttribute('data-minutes'), 10);
      setTime(minutes * 60);
    });
  });

  /* -------------------------
     カスタム時間ボタンの処理
     ------------------------- */
  customTimeBtn.addEventListener('click', () => {
    const customVal = parseInt(customInput.value, 10);
    if(!isNaN(customVal) && customVal > 0) {
      setTime(customVal * 60);
    }
  });

  /* -------------------------
     スタート・ストップ・リセット
     ------------------------- */
  startBtn.addEventListener('click', startTimer);
  stopBtn.addEventListener('click', stopTimer);
  resetBtn.addEventListener('click', resetTimer);

  /* -------------------------
     タイマー操作関数
     ------------------------- */
  function setTime(seconds) {
    stopTimer(); // 一旦停止
    totalTime = seconds;
    remainingTime = seconds;
    updateDisplay(remainingTime, totalTime);
  }

  function startTimer() {
    if(totalTime <= 0) return; // 時間未設定の場合は何もしない
    if(timerInterval) return;  // 連続スタート防止

    timerInterval = setInterval(()=>{
      remainingTime--;
      if(remainingTime <= 0) {
        remainingTime = 0;
        stopTimer();
      }
      updateDisplay(remainingTime, totalTime);
    }, 1000);
  }

  function stopTimer() {
    if(timerInterval) {
      clearInterval(timerInterval);
      timerInterval = null;
    }
  }

  function resetTimer() {
    stopTimer();
    remainingTime = totalTime;
    updateDisplay(remainingTime, totalTime);
  }

  /* -------------------------
     タイマー表示のアップデート
     ------------------------- */
  function updateDisplay(remain, total) {
    switch(currentMode) {
      case 'circle': updateCircle(remain, total); break;
      case 'bar':    updateBar(remain, total);    break;
      case 'sand':   updateSand(remain, total);   break;
      case 'count':  updateCount(remain, total);  break;
    }
  }

  /* (1) Circle Timer の更新 */
  function updateCircle(remain, total) {
    // 0〜360度に換算
    let ratio = (total - remain) / total; // 経過率
    if(ratio < 0) ratio = 0;
    if(ratio > 1) ratio = 1;

    // 経過角度
    const angle = 360 * ratio;
    // 円の中心 (50,50) 半径45
    // パスを円弧で描画 (大まかな書き方)
    // 大きな円弧は (x, y) をうまく計算
    const largeArc = angle > 180 ? 1 : 0;
    // 終了座標を計算（度をラジアンに変換）
    const endX = 50 + 45 * Math.sin(Math.PI * (angle/180));
    const endY = 50 - 45 * Math.cos(Math.PI * (angle/180));

    // 開始点は (50, 5) → 12時方向
    let d = "";
    if(angle > 0){
      d = `M 50,5 
           A 45,45 0 ${largeArc} 1 ${endX},${endY} 
           L 50,50 Z`;
    }
    circleFillPath.setAttribute('d', d);
  }

  /* (2) Bar Timer の更新 */
  function updateBar(remain, total) {
    let ratio = (total - remain) / total;
    if(ratio < 0) ratio = 0;
    if(ratio > 1) ratio = 1;
    const percent = (ratio * 100).toFixed(2) + '%';
    barFill.style.width = percent;
  }

  /* (3) Sand Timer の更新 */
  function updateSand(remain, total) {
    // 経過率
    let ratio = (total - remain) / total;
    if(ratio < 0) ratio = 0;
    if(ratio > 1) ratio = 1;

    // 砂が上から下に移動するイメージ
    // 上の砂: ratioに応じて「減る」
    // 下の砂: ratioに応じて「増える」
    // 高さ最大値を仮に80pxくらいに
    const maxSandHeight = 80;
    const topHeight = (1 - ratio) * maxSandHeight;
    const bottomHeight = ratio * maxSandHeight;

    sandTop.style.height = topHeight + 'px';
    sandBottom.style.height = bottomHeight + 'px';
  }

  /* (4) Count Timer の更新 */
  function updateCount(remain, total) {
    // 初期化
    while(countTimer.firstChild){
      countTimer.removeChild(countTimer.firstChild);
    }
    // 残り時間ぶんのオブジェクトを表示 or 経過ぶん削る手法
    // ここでは「残り時間ぶんを表示」して消えていくイメージで。
    // total秒のうち、経過秒
    const used = total - remain;
    // すでに消えた個数 = used, まだある個数 = remain
    // remain個のアイテムを生成
    for(let i = 0; i < remain; i++){
      const div = document.createElement('div');
      div.className = 'count-item';
      countTimer.appendChild(div);
    }
  }

  /* -------------------------
     表示リセット関数
     ------------------------- */
  function hideAllTimerDisplays(){
    circleTimer.classList.add('hidden');
    barTimer.classList.add('hidden');
    sandTimer.classList.add('hidden');
    countTimer.classList.add('hidden');
  }

  function resetAllDisplays(){
    // 時間の初期化
    totalTime = 0;
    remainingTime = 0;
    stopTimer();

    // 各表示を初期状態に
    circleFillPath.setAttribute('d', '');
    barFill.style.width = '0%';
    sandTop.style.height = '0px';
    sandBottom.style.height = '0px';
    while(countTimer.firstChild){
      countTimer.removeChild(countTimer.firstChild);
    }
    customInput.value = "";
  }

})();
</script>
</body>
</html>

