<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>みえるタイマー</title>
  <style>
    /* ===== リセット＆ベース ===== */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: sans-serif;
    }
    body {
      background: #fff8e1;
      color: #333;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: center;
      padding: 1rem;
    }

    h1, h2, h3 {
      margin-bottom: 0.5rem;
    }
    h1 {
      font-size: 2rem;
      color: #ff6f00;
      text-align: center;
      margin-bottom: 1rem;
    }

    /* ===== ボタン共通スタイル ===== */
    button {
      background-color: #ffd54f;
      color: #333;
      border: 2px solid #ffecb3;
      border-radius: 8px;
      font-size: 1rem;
      padding: 0.5rem 1rem;
      margin: 0.5rem;
      cursor: pointer;
      transition: 0.3s;
    }
    button:hover {
      background-color: #fff59d;
    }

    /* ===== 画面切り替えのための表示/非表示 ===== */
    .hidden {
      display: none;
    }

    /* ===== トップ画面 ===== */
    #home {
      text-align: center;
    }
    #pattern-buttons {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 1rem;
      margin-top: 1rem;
    }
    .pattern-btn {
      width: 120px;
      height: 120px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      border-radius: 10px;
      font-size: 1rem;
      background-color: #ffe082;
      border: 3px solid #fff8e1;
      box-shadow: 2px 2px 6px rgba(0,0,0,0.1);
    }

    /* ===== タイマー画面 ===== */
    #timer-screen {
      text-align: center;
    }
    #time-options {
      margin: 1rem 0;
    }
    .time-btn {
      min-width: 60px;
    }
    #custom-time {
      width: 50px;
      text-align: center;
      margin-left: 0.5rem;
    }
    #timer-controls {
      margin-top: 1rem;
    }

    /* ===== 表示領域 ===== */
    #timer-display {
      margin-top: 1rem;
      width: 300px;
      height: 300px;
      background: #fff3e0;
      border-radius: 15px;
      margin-bottom: 1rem;
      position: relative;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* --- 円（時計）のスタイル例 --- */
    .circle-container {
      position: relative;
      width: 200px;
      height: 200px;
    }
    .circle-bg {
      position: absolute;
      top: 0;
      left: 0;
      width: 200px;
      height: 200px;
      border-radius: 50%;
      border: 10px solid #ffc107;
    }
    .circle-fill {
      position: absolute;
      top: 0;
      left: 0;
      width: 200px;
      height: 200px;
      border-radius: 50%;
      clip: rect(0px, 200px, 200px, 100px);
      /* clipを使って半円単位で塗りつぶしをコントロール */
    }
    .circle-fill::before {
      content: "";
      position: absolute;
      border: 10px solid #ffca28;
      width: 200px;
      height: 200px;
      border-radius: 50%;
      clip: rect(0px, 100px, 200px, 0px);
      transform: rotate(0deg);
      transform-origin: center center;
    }

    /* --- バーのスタイル例 --- */
    .bar-container {
      width: 80%;
      height: 30px;
      background-color: #ffc107;
      border-radius: 15px;
      overflow: hidden;
      position: relative;
    }
    .bar-fill {
      position: absolute;
      top: 0;
      left: 0;
      height: 30px;
      background-color: #ffca28;
      width: 100%;
      transition: width 0.2s linear;
    }

    /* --- 砂時計のスタイル例 --- */
    .hourglass {
      width: 100px;
      height: 150px;
      background: linear-gradient(to bottom, #ffca28 50%, transparent 50%);
      position: relative;
    }
    .hourglass::before,
    .hourglass::after {
      content: "";
      position: absolute;
      left: 0;
      width: 100px;
      height: 50%;
      border: 3px solid #ffb300;
      border-top-left-radius: 50px;
      border-top-right-radius: 50px;
      border-bottom-left-radius: 50px;
      border-bottom-right-radius: 50px;
    }
    .hourglass::before {
      top: 0;
      border-bottom: none;
      transform: rotate(180deg);
    }
    .hourglass::after {
      bottom: 0;
      border-top: none;
    }

    /* --- 個数のスタイル例 --- */
    .dots-container {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
      max-width: 250px;
    }
    .dot {
      width: 40px;
      height: 40px;
      background-color: #ffc107;
      border-radius: 50%;
    }
  </style>
</head>
<body>

  <!-- ========== トップページ ========== -->
  <div id="home">
    <h1>みえるタイマー</h1>
    <h2>パターンをえらんでね！</h2>
    <div id="pattern-buttons">
      <button class="pattern-btn" data-pattern="circle">
        まる<br>(時計)
      </button>
      <button class="pattern-btn" data-pattern="bar">
        バー
      </button>
      <button class="pattern-btn" data-pattern="hourglass">
        すな<br>どけい
      </button>
      <button class="pattern-btn" data-pattern="dots">
        こすう<br>(しるし)
      </button>
    </div>
  </div>

  <!-- ========== タイマー画面 ========== -->
  <div id="timer-screen" class="hidden">
    <h2 id="pattern-name"></h2>
    <!-- タイマー表示領域 -->
    <div id="timer-display"></div>

    <!-- 時間設定 -->
    <div id="time-options">
      <button class="time-btn" data-time="1">1分</button>
      <button class="time-btn" data-time="3">3分</button>
      <button class="time-btn" data-time="5">5分</button>
      <br />
      <label>自由設定:
        <input id="custom-time" type="number" min="1" max="60" placeholder="分" />
      </label>
    </div>

    <!-- スタート/ストップ/リセット -->
    <div id="timer-controls">
      <button id="start-btn">スタート</button>
      <button id="stop-btn">ストップ</button>
      <button id="reset-btn">リセット</button>
    </div>

    <!-- 戻るボタン -->
    <div>
      <button id="back-btn">もどる</button>
    </div>
  </div>

  <script>
    /************************************************************
     * グローバル変数＆初期設定
     ************************************************************/
    let currentPattern = "";       // 選択中のパターン ("circle", "bar", "hourglass", "dots")
    let totalTime = 60;            // デフォルト(秒) 1分
    let remainingTime = 60;        // 残り時間(秒)
    let timerInterval = null;      // setInterval管理用

    const home = document.getElementById("home");
    const timerScreen = document.getElementById("timer-screen");
    const patternName = document.getElementById("pattern-name");
    const timerDisplay = document.getElementById("timer-display");

    // ボタンたち
    const patternButtons = document.querySelectorAll("#pattern-buttons .pattern-btn");
    const timeButtons = document.querySelectorAll("#time-options .time-btn");
    const customTimeInput = document.getElementById("custom-time");
    const startBtn = document.getElementById("start-btn");
    const stopBtn = document.getElementById("stop-btn");
    const resetBtn = document.getElementById("reset-btn");
    const backBtn = document.getElementById("back-btn");

    /************************************************************
     * イベント登録
     ************************************************************/
    // パターン選択ボタン
    patternButtons.forEach(btn => {
      btn.addEventListener("click", () => {
        currentPattern = btn.dataset.pattern;
        showTimerScreen();
      });
    });

    // 時間プリセットボタン
    timeButtons.forEach(btn => {
      btn.addEventListener("click", () => {
        const minutes = parseInt(btn.dataset.time, 10);
        setTime(minutes);
      });
    });

    // 自由入力
    customTimeInput.addEventListener("change", () => {
      const minutes = parseInt(customTimeInput.value, 10);
      if (!isNaN(minutes) && minutes > 0) {
        setTime(minutes);
      }
    });

    // スタート/ストップ/リセット
    startBtn.addEventListener("click", startTimer);
    stopBtn.addEventListener("click", stopTimer);
    resetBtn.addEventListener("click", resetTimer);

    // 戻るボタン
    backBtn.addEventListener("click", () => {
      stopTimer();
      home.classList.remove("hidden");
      timerScreen.classList.add("hidden");
      timerDisplay.innerHTML = "";
    });

    /************************************************************
     * 画面遷移
     ************************************************************/
    function showTimerScreen() {
      home.classList.add("hidden");
      timerScreen.classList.remove("hidden");

      // パターン名表示
      let nameJP = "";
      switch(currentPattern) {
        case "circle":    nameJP = "まる（時計）"; break;
        case "bar":       nameJP = "バー";        break;
        case "hourglass": nameJP = "すなどけい";  break;
        case "dots":      nameJP = "こすう";      break;
        default:          nameJP = "？？？";      break;
      }
      patternName.textContent = nameJP;

      // デフォルト1分にリセット
      setTime(1);
      resetTimer();
    }

    /************************************************************
     * タイマー設定＆描画
     ************************************************************/
    // 時間設定（分 → 秒）
    function setTime(minutes) {
      totalTime = minutes * 60;
      remainingTime = totalTime;
      updateDisplay(0); // 0%消化で描画
    }

    // 表示更新
    // progressRatio: 0(スタート時) ～ 1(終了時)
    function updateDisplay(progressRatio) {
      // タイマー領域を一旦クリア
      timerDisplay.innerHTML = "";

      switch(currentPattern) {
        case "circle":
          drawCircle(progressRatio);
          break;
        case "bar":
          drawBar(progressRatio);
          break;
        case "hourglass":
          drawHourglass(progressRatio);
          break;
        case "dots":
          drawDots(progressRatio);
          break;
      }
    }

    // --- 1) 円（時計）パターン ---
    function drawCircle(progressRatio) {
      const container = document.createElement("div");
      container.className = "circle-container";

      // 円の下地
      const bg = document.createElement("div");
      bg.className = "circle-bg";

      // 円の塗りつぶし
      const fill = document.createElement("div");
      fill.className = "circle-fill";

      // 塗りつぶし角度 (時計回り)
      const angle = 360 * progressRatio;
      fill.style.transform = `rotate(${angle}deg)`;

      // fill::before への角度指定
      fill.style.setProperty("--progress-angle", angle);

      container.appendChild(bg);
      container.appendChild(fill);
      timerDisplay.appendChild(container);
    }

    // --- 2) バーのパターン ---
    function drawBar(progressRatio) {
      const barContainer = document.createElement("div");
      barContainer.className = "bar-container";

      const barFill = document.createElement("div");
      barFill.className = "bar-fill";

      // 幅の変化
      const fillWidth = (1 - progressRatio) * 100; // 残り時間割合
      barFill.style.width = fillWidth + "%";

      barContainer.appendChild(barFill);
      timerDisplay.appendChild(barContainer);
    }

    // --- 3) 砂時計パターン ---
    function drawHourglass(progressRatio) {
      // 砂が落ちた割合を表すための比率(0 → 1)
      // progressRatio は経過率 → 砂時計は"上が少なくなり、下が増える"
      // ここでは簡易的に上: (1 - progressRatio) 下: progressRatio で表示
      const hourglass = document.createElement("div");
      hourglass.className = "hourglass";

      // 背景のgradを制御: 0%で上半分全部砂、1%で下半分全部砂
      // ここでは linear-gradient を動的に更新
      const topPercent = 50 * (1 - progressRatio);     // 上の砂部分
      const bottomPercent = 50 * progressRatio;        // 下の砂部分
      hourglass.style.background = `linear-gradient(to bottom, 
        #ffca28 ${topPercent}%, 
        transparent ${topPercent}%,
        transparent ${50}%, 
        #ffca28 ${50}%, 
        #ffca28 ${50 + bottomPercent}%, 
        transparent ${50 + bottomPercent}%
      )`;

      timerDisplay.appendChild(hourglass);
    }

    // --- 4) 個数のパターン ---
    function drawDots(progressRatio) {
      const container = document.createElement("div");
      container.className = "dots-container";

      // 仮に最大10個とする
      const maxDots = 10;
      // 残存数
      const remainingDots = Math.ceil((1 - progressRatio) * maxDots);

      for (let i = 0; i < remainingDots; i++) {
        const dot = document.createElement("div");
        dot.className = "dot";
        container.appendChild(dot);
      }
      timerDisplay.appendChild(container);
    }

    /************************************************************
     * タイマー制御
     ************************************************************/
    function startTimer() {
      if (timerInterval) return; // 二重起動防止

      timerInterval = setInterval(() => {
        remainingTime--;
        if (remainingTime < 0) {
          stopTimer();
          remainingTime = 0;
          alert("おしまい！");
          return;
        }
        const progress = 1 - (remainingTime / totalTime);
        updateDisplay(progress);
      }, 1000);
    }

    function stopTimer() {
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }
    }

    function resetTimer() {
      stopTimer();
      remainingTime = totalTime;
      updateDisplay(0);
    }
  </script>
</body>
</html>
